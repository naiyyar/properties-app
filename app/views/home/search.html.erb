<div class="row">
	<%= render partial: 'search' %>
</div>

<div class="row voffset50 search-results-container">
	<% if @buildings.present? %>
		<div class="col-lg-7">
			<div class="map-continer">
	        	<div id="map" style="height: 500px;"></div>
	      	</div>
		</div>

		<div class="col-lg-5">
			<div class="pre-scrollable" style="max-height: 70vh;">
				<% @buildings.each do |building| %>
					<div class="row search-result-container">
						<div class="search-slider">
						  <div id="myCarousel<%= building.id %>" class="carousel slide" data-ride="carousel">
						    <!-- Wrapper for slides -->
						    <div class="carousel-inner" role="listbox">
					    		<%if building.uploads.present? %>
						    		<% building.uploads.each_with_index do |upload, index| %>
								      <div class="item <%= index == 0 ? 'active' : '' %>" data-slide-number="<%= index %>">
								        <%= image_tag upload.image.url, alt: upload.image_file_name, style: "width: 460; height: 345;" %>
								      </div>
								    <%end%>
								  <%else%>
								  	<div class="item active" data-slide-number="0">
								  		<%= image_tag 'no-photo-available.jpg', alt: 'No image', style: "width: 460; height: 345;" %>
							      </div>
								  <%end%>
						    </div>
						    <!-- Left and right controls -->
						    <a class="left carousel-control" href="#myCarousel<%= building.id %>" role="button" data-slide="prev">
						      <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
						      <span class="sr-only">Previous</span>
						    </a>
						    <a class="right carousel-control" href="#myCarousel<%= building.id %>" role="button" data-slide="next">
						      <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
						      <span class="sr-only">Next</span>
						    </a>
						  </div>
						</div>
						<div>
							<a href="<%=building_path(building)%>" id="apt_sidebar_container<%=building.id%>">
								<%#= link_to building_path(building) do %>
									<!-- <h4 class='list-group-item-heading'> <%#= building.building_name %> </h4> -->
	  							<!-- <p class='list-group-item-text'><%#= "#{building.building_street_address} #{building.zipcode}" %></p> -->
	  						<%#end%>
							</a>
							<br />
							<ul class="list-inline">
						 		<li>Reviews: <%= building.reviews.count %></li> |
						 		<li>Unit reviews: <%= building.unit_reviews_count %></li> |
						 		<li>Photos(<%= building.uploads ? building.uploads.count : '' %>)</li>
							</ul>
							<ul class="list-inline" style="margin-left: 126px;">
						 		<li><%= rating_for building, "building", disable_after_rate: true, cancel: false %></li> |
						 		<li><%= "20% Recommended" %></li>
							</ul>
						</div>
					</div>
				<%end%>
			</div>
		</div>
	<%end%>
</div>

<script type="text/javascript" charset="utf-8">
	lat = <%= raw @lat.to_json %>
	lng = <%= raw @lng.to_json %>
	zoom = <%= @zoom %>
	//src = "https://developers.google.com/maps/documentation/javascript/examples/kml/westcampus.kml"
	// function initMap() {
	// 	src = "https://developers.google.com/maps/documentation/javascript/examples/kml/westcampus.kml"
 //        map = new google.maps.Map(document.getElementById('map'), {
 //          center: new google.maps.LatLng(lng, lat),
 //          zoom: 2,
 //          mapTypeId: 'terrain'
 //        });
 //        loadKmlLayer(src, map);
 //    }

 //    function loadKmlLayer(src, map) {
	//     var ctaLayer = new google.maps.KmlLayer({
 //            //url: 'https://www.dropbox.com/s/0grhlim3q4572jp/ROU_adm2%20-%20Copy.kml?dl=1'
 //            //url: 'https://www.dropbox.com/s/oheen11js2srxsz/rou.kml?dl=1'
 //            //url: 'https://www.dropbox.com/s/xnpmp4nqq3bz3w0/10040_1.kml?dl=1'
 //            //url: 'https://www.dropbox.com/s/1ovesqadpzmclch/10040.kml?dl=1'
 //            url: 'https://www.dropbox.com/s/9l4cjqm5rwlxmsv/doc_10040.kml?dl=1'

	// 	});
	//     ctaLayer.setMap(map);
 //  	}

 //  	function loadScript(){
 //  		var script = document.createElement('script')
 //  		script.src = "//maps.google.com/maps/api/js?v=3.23&key=AIzaSyDZtWN-GlVsIjuQMP8xN5dit3PmlMb-qjA&callback=initMap"
 //  		document.body.appendChild(script)
 //  	}

 //  	window.onload = loadScript;
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
  	
  	json_array = <%= raw @hash.to_json %> ;
    
    markers = handler.addMarkers(json_array);
    
    _.each(json_array, function(json, index){
		  json.marker = markers[index];
		  bindMarker(json.marker, markers, handler, lat, lng, <%= @zoom %>);
		});
		
		polygons = handler.addPolygons( <%= raw @boundary_coords.to_json %> ,
    	{ strokeColor: '#FF0000' }
	  );

		// var kmls = handler.addKml(
  //   		{ url: "https://www.dropbox.com/s/9l4cjqm5rwlxmsv/doc_10040.kml?dl=1" }
  // 		);
		
	  createSidebar(json_array);
  });
  
  
</script>
