<%= render partial: 'search_wrapper' %>

<script type="text/javascript" charset="utf-8">
	var lat = <%= raw @lat.to_json %>
	var lng = <%= raw @lng.to_json %>
	var zoom = <%= @zoom %>
	seach_term = <%= raw @brooklyn_neighborhoods.to_json %>
	
 	handler = Gmaps.build('Google');
 	handler.buildMap({ provider: {}, internal: {id: 'mapView'}}, function(){
	
  	json_array = <%= raw @hash.to_json %> ;
    
    markers = handler.addMarkers(json_array);
    
    _.each(json_array, function(json, index){
	  json.marker = markers[index];
	  bindMarker(json.marker, markers, handler, lat, lng, zoom );
	});
		
	//Plogon options
	//{ strokeColor: '#FF0000', strokeOpacity: 0.7, strokeWeight: 2, fillColor: '#FFFFFF', fillOpacity: 0.15 }
	polygons = handler.addPolygons( <%= raw @boundary_coords.to_json %> ,
    { strokeColor: '#2e2e2e', strokeWeight: 2 }
	);
	
	brooklyn_and_queens_neighborhoods(seach_term) //In search.js

  	createSidebar(json_array);
	});
  
  
</script>
