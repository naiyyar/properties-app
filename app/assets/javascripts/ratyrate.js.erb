function load_rating_stars(){
  $.fn.raty.defaults.half = false;
  $.fn.raty.defaults.halfShow = true;
  //$.fn.raty.defaults.path = "/assets";
  $.fn.raty.defaults.cancel = false;

  //$(function(){
    $(".star").each(function() {
      var $readonly = ($(this).attr('data-readonly') == 'true');
      var $half     = ($(this).attr('data-enable-half') == 'true');
      var $halfShow = ($(this).attr('data-half-show') == 'true');
      var $single   = ($(this).attr('data-single') == 'true');
      $(this).raty({
        score: function() {
          return $(this).attr('data-rating')
        },
        number: function() {
          return $(this).attr('data-star-count')
        },
        half:        $half,
        halfShow:    $halfShow,
        single:      $single,
        path:        $(this).attr('data-star-path'),
        starOn:      $(this).attr('data-star-on'),
        starOff:     $(this).attr('data-star-off'),
        starHalf:    $(this).attr('data-star-half'),
        cancel:      $(this).attr('data-cancel'),
        cancelPlace: $(this).attr('data-cancel-place'),
        cancelHint:  $(this).attr('data-cancel-hint'),
        cancelOn:    $(this).attr('data-cancel-on'),
        cancelOff:   $(this).attr(''), //data-cancel-off
        noRatedMsg:  $(this).attr('data-no-rated-message'),
        round:       $(this).attr('data-round'),
        space:       $(this).attr('data-space'),
        target:      $(this).attr('data-target'),
        targetText:  $(this).attr('data-target-text'),
        targetType:  $(this).attr('data-target-type'),
        targetFormat: $(this).attr('data-target-format'),
        targetScoret: $(this).attr('data-target-score'),
        readOnly: $readonly,
        // click: function(score, evt) {
        //   var _this = this;
        //   if (score == null) { score = 0; }
        //   $.post('<%= Rails.application.class.routes.url_helpers.rate_path %>',
        //   {
        //     score: score,
        //     dimension: $(this).attr('data-dimension'),
        //     id: $(this).attr('data-id'),
        //     klass: $(this).attr('data-classname'),
        //     review_id: ''
        //   },
        //   function(data) {
        //     if(data) {
        //       // success code goes here ...

        //       if ($(_this).attr('data-disable-after-rate') == 'true') {
        //         $(_this).raty('set', { readOnly: true, score: score });
        //       }
        //     }
        //   });
        // }
      });
    });
  //});

}

$(function(){
  load_rating_stars();
  //setting score input name value dimension
  $.each($('.star'), function(i, j){
    var dimension = $(j).data('dimension');
    var scrore_elem = $(j).children('input');
    //scrore_elem.attr
    scrore_elem.attr('name', 'score['+dimension+']');

    //To apply validations: Need to convert type hidden field to text
    if($('#new_review').length > 0){
      scrore_elem.attr('type','text').addClass('invisible');
    }
  });
  var start_off = "<%= asset_path 'star-off.png' %>";
  //Custom emoji icon rating for review forms
  $(document).on('mouseover', '.starEmoji img', function(e){
    var score = parseInt($(this).data('rating'));
    var dim = $(this).parent().data('dimension');
    //$(this).parent().attr('data-score', score);
    var final_score = parseInt($('.score_'+dim).val());
    
    //once clicked and final score set and again try to change the rating then
    // setting all all stars to off
    if(final_score != '' || final_score != undefined || final_score != NaN){
      $(this).parent().children('img').each(function(i,j){
        $(j).attr('src', start_off);
      })
    }

    //setting all all selected stars to on with emoji icons
    setEmojiIcon($(this), score)

  }).on('mouseout', '.starEmoji img', function(e){
    var score = parseInt($(this).data('rating'));
    var dim = $(this).parent().data('dimension');
    // $(this).parent().attr('data-score', score);
    var final_scoreo = parseInt($('.score_'+dim).val());
    
    //Making stars to off
    for(i=1; i <= score; i++ ){
      var img_elem = $(this).parent().find("[data-rating='" + i + "']"); 
      img_elem.attr('src', start_off);  
    }

    if(final_scoreo != '' || final_scoreo != undefined || final_scoreo != NaN){
      setEmojiIcon($(this), final_scoreo)
    }
    
  }).on('click', '.starEmoji img', function(e){
    var dim = $(this).parent().data('dimension');
    var score = parseInt($(this).data('rating'));
    
    $('.score_'+dim).val(score);
    
    if(score != '' || score != undefined || score != NaN){
      setEmojiIcon($(this), score)
    }
  });

  function setEmojiIcon(elem, score){
    for(i=1; i <= score; i++ ){
      console.log("<%= asset_path 'star5-sm.png' %>")
      var img_elem = elem.parent().find("[data-rating='" + i + "']");
        if(i==1){
          img_elem.attr('src',"<%= asset_path 'star1-sm.png' %>");
        }
        else if(i==2){
          img_elem.attr('src',"<%= asset_path 'star2-sm.png' %>");
        } 
        else if(i==3){
          img_elem.attr('src',"<%= asset_path 'star3-sm.png' %>");
        } 
        else if(i==4){
          img_elem.attr('src',"<%= asset_path 'star4-sm.png' %>");
        } 
        else if(i==5){
          img_elem.attr('src',"<%= asset_path 'star5-sm.png' %>");
        } 
          
    }
  }

});